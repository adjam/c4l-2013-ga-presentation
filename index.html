<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">

        <title>Google Analytics, Event Tracking and Discovery Tools</title>

        <meta name="description" content="Being A Presentation To The Aseembled Body In Chicago">
        <meta name="author" content="Emily Lynema, Adam Constabaris">

        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <link rel="stylesheet" href="css/reveal.min.css">
        <link rel="stylesheet" href="css/theme/sky.css" id="theme">

        <!-- For syntax highlighting -->
        <link rel="stylesheet" href="lib/css/zenburn.css">


        <style type="text/css">
         @-webkit-keyframes blink {
            from { opacity: 1.0; }
            to { opacity: 0.0; }
         }

         #blinky {
            -webkit-animation-name: blink;
            -webkit-animation-iteration-count: infinite;
            -webkit-animation-timing-function: cubic-bezier;
            -webkit-animation-duration: 1s;
         }
         </style>

        <!-- If the query includes 'print-pdf', use the PDF print sheet -->
        <script>
            document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
        </script>

        <!--[if lt IE 9]>
        <script src="lib/js/html5shiv.js"></script>
        <![endif]-->
    </head>

    <body>

        <div class="reveal">

            <!-- Any section element inside of this container is displayed as a slide -->
            <div class="slides">

                <section>
                    <h2>Google Analytics, Event Tracking and Discovery Tools</h2>
                    <h5>Going Beyond Pageviews</h5>
                    <small>
                    <p>
                        Emily Lynema, Associate Head, IT NCSU Libraries
                    </p>                        
                    <p>
                        Adam Constabaris, Singe de Code, NCSU Libraries
                    </p>
                    <img src="images/ncsu-libraries-logo.png" style="border: none; box-shadow: none;"/>
                </small>
                </section>
				<section>
                <section>
                    <h2>Overview</h2>
                    <p>
                        Google Analytics can be used to track not only pageviews, but in-page events, allowing you to understand more
                        about how your site is being used.
                    </p>

                    <aside class="notes">
                        This is how you embed speaker notes.  Hit 's' to open 'em up.
                    </aside>
                </section>
                	<section>
                		<h2>Some Details</h2>
                		<ul>
                			<li>Track any user action you can identify with JavaScript</li>
                			<li>You decide what to track!</li>
                				<ul>
                					<li>Which user events?</li>
                					<li>How should they be categorized?</li>
                				</ul>
                			<li>Use simple JavaScript to push events to Google</li>
                			<li>Enjoy Google Analytic's feature-full reporting interface</li>
                		</ul>
                		<aside class="notes">A set of tools within Google Analytics for tracking user actions in a locally customizable, granular way. You decide what to record and how to categorize it. If you are already loading the Google Analytics Javascript snippet into your site to track pageviews, you've already pretty much done all the setup that you need to do. Rather than pushing a javascript call that pushes the standard pageview into Google Analytics for tracking and reporting, you manually push an event that a user performs on your site. Along with the event, you push up several different categories to describe it -- these can be used for slicing and dicing your reporting later.
						As Adam will discuss in more detail, this means that with a little information architecture laid out over your events and a little javascript hacking, you have a nice user interface for reporting in more granular detail exactly what users are doing.
						</aside>
					</section>
					<section>
						<h2>Why Care?</h2>
						<p class="fragment">Have real patron data to use to improve usability of your site.</p>
						<p class="fragment">Make data-driven design decisions. </p>
					</section>
					<aside class="notes">Stop long arguments about design by showing what users do and don't do in your interfaces.</aside>
				</section>
                <!-- Example of nested vertical slides -->
                <section>
                    <section>
                    	<h2>Event Tracking Use Cases</h2>
                    	<ul>
                    		<li class="fragment">Hidden or externally loaded (AJAX) content</li>
                    	</ul>
                    </section>
                     <section> 
                         <a class="image" href="images/catalog-hidden-content.png" target="_blank">
                            <img src="images/catalog-hidden-content.png" alt="Full Record Preview" />
                        </a>
                        <aside class="notes">
                            Some content on the page is hidden when the page loads; users access that content 
                            by following a link.  
                        </aside>
                    </section>
                    <section> 
                         <a class="image" href="images/catalog-record-ajax.png" target="_blank">
                            <img src="images/catalog-record-ajax.png" alt="Full Record Preview" />
                        </a>
                        <aside class="notes">
                            Other content is not loaded initially, but is on user demand (as in the tabs).
                        </aside>
                    </section>
                    <section>
                    	<ul>
                    	<li>Hidden or externally loaded (AJAX) content</li>
                    	<li>Internal links that occur in multiple places</li>
                    	</ul>
                    </section>
                    <section> 
                         <a class="image" href="images/catalog-record-request.png" target="_blank">
                            <img src="images/catalog-record-request.png" alt="Full Record Preview" />
                        </a>
                        <aside class="notes">
                            
                        </aside>
                    </section>
                    <section> 
                         <a class="image" href="images/catalog-record-browse.png" target="_blank">
                            <img src="images/catalog-record-browse.png" alt="Full Record Preview" />
                        </a>
                        <aside class="notes">
                            
                        </aside>
                    </section>
                    <section>
                    	<ul>
                    	<li>Hidden or externally loaded (AJAX) content</li>
                    	<li>Internal links that occur in multiple places</li>
                    	<li>External links</li>
                    	</ul>
                    </section>
                    <section> 
                         <a class="image" href="images/catalog-record-external.png" target="_blank">
                            <img src="images/catalog-record-external.png" alt="Full Record Preview" />
                        </a>
                        <aside class="notes">
                            
                        </aside>
                    </section>
                    <section>
                    	<ul>
                    	<li>Hidden or externally loaded (AJAX) content</li>
                    	<li>Internal links that occur in multiple places</li>
                    	<li>External links</li>
                    	<li>Actions that are difficult to extract from pageview URLs</li>
                    		<ul>
                    		<li><code>http://catalog.lib.ncsu.edu/search?Ntk=Keyword&N=206432&view=full&Ntt=java</code> means User clicked "Available online" checkbox</li>
                    		</ul>
                    	</ul>
                    </section>
                    <section> 
                         <a class="image" href="images/results-difficult-pageviews.png" target="_blank">
                            <img src="images/results-difficult-pageviews.png" alt="Full Record Preview" />
                        </a>
                        <aside class="notes">
                            
                        </aside>
                    </section>
                   
                </section>
                <section>
                	<section>
                		<h2>NCSU Catalog Activity(*)</h2>
                		 	<p class="fragment">Tracking LOTS of things</p>
                			<p class="fragment">(*) But not all of them for very long</p><br />
                			<p class="fragment">This is the time for planning. How to categorize events to achieve the desired reports?</p>
                	</section>
                	<section>
            			<h2>What are we tracking?</h2>
            			<ul>
            				<li>Results List clicks</li>
            				<li>Facet expand / close</li>
            				<li>Facet checkboxes</li>
            				<li>Send search out to TRLN / WorldCat / Summon</li>
            				<li>Full record tools</li>
            				<li>Full record tabs</li>
            				<li>Location tab clicks (request, browse, full text)</li>
            				<li>External URLs on the full record (finding aids, full text)</li>
            				<li>Browse (shelf browse / subject browse)</li>
            			</ul>
            		</section>
            		<section>
            			<h2>Category: Results</h2>
            			<small>Clicks in the body of the results</small>
            			<p>FullText | Add List | Volumes</p>
            		</section>
            		<section>
            			<h2>Category: Facet</h2>
            			<small>Clicks on facets. Note: We were primarily interested in user behavior of opening and/or closing facets.</small>
            			<p>Show More | Expand</p>
            		</section>
            		<section>
            			<h2>Category: FacetCheckbox</h2>
            			<small>Clicks on special checkbox options</small>
            			<p>Online | Available | New</p>
            		</section>
            		<section>
            			<h2>Category: Expand Search</h2>
            			<small>Send search to other discovery tools</small>
            			<p>TRLN | WorldCat | Summon</p>
            		</section>
            		<section>
            			<h2>Category: Tools</h2>
            			<small>Toolstrip actions on the full record</small>
            			<p>Request | Text | Email | Print | Refworks | Google Preview | Add List</p>
            		</section>
            		<section>
            			<h2>Category: Tabs</h2>
            			<small>Tab clicks on the full record</small>
            			<p>Location | Details | Contents | MARC | Preview | History</p>
            		</section>
            		<section>
            			<h2>Category: Location tab</h2>
            			<small>Clicks within the Location tab</small>
            			<p>Browse Shelf | Request | Full Text | Volumes</p>
            		</section>
            		<section>
            			<h2>Category: URL</h2>
            			<small>Assorted external URLs on the full record</small>
            			<p>FullText | FindingAid | DigitizedContent</p>
            		</section>
            		<section>
            			<h2>Category: Browse</h2>
            			<small>Options to browse related materials</small>
            			<p>Browse Shelf | Subjects</p>
            		</section>
            	</section>
            	<section>
					<section>
						<h2>Interesting Findings</h2>
						<small>various dates</small>
						<aside class="notes">It's a little out of scope for this short presentation to share all of our statistics, but I wanted to pick out some interesting and/or surprising things to share. I can make more complete statistics available to those who might be interested. </aside>
					</section>
					<section>
						<h5>Whoa....look at those tabs.</h5>
						<a class="image"  href="images/catalog-event-categories.png" target="_blank">
                            <img  src="images/catalog-event-categories.png" alt="Full Record Preview" />
                        </a>
                        <small>Note: February 5-7, 2013</small>
                        <aside class="notes">Note that full text activity is scattered across URL, Location Tab, and Results. It's a big reason that the URL category is so high. The Location Tab contains some
                        	frequently used items, particularly requesting and shelf browsing. A note about the dates....we just finally got some code released last week that contributed numbers for several categories of activity, particularly
                        	full text URLs and things on the results list. In order to include that activity, I've had to limit the date range for these overall statistics. As I'll note on the next slide, that may skew things a little, but overall the trends
                        	are very similar when compared out across the last 3-4 months.</aside>
                    </section>
					<section>
						<h5>Wait...do I see MARC??</h5>
						<a class="image"  href="images/catalog-specific-events.png" target="_blank">
                            <img  src="images/catalog-specific-events.png" alt="Full Record Preview" />
                        </a>
                        <small>Note: February 5-7, 2013</small>
                        <aside class="notes">This data is our second level "actions" -- not categories of events but specific events. It's interesting to again note the prominence of
                        	tab activity here. We saw this confirmed in usability testing recently -- the users literally run through and click on all the tabs no matter what they are
                        	called as one of their first activities if they are looking for something. This includes the MARC tab that we thought no one but staff ever clicked on.
                        	Doesn't mean that the users know what it is; they usually look at it and are like "whatever that is..." I'm also interested, and a little disappointed by the number
                        	of clicks on the "Details" tab. It's the second tab in our interface, and really, things like ISBN, other authors, other titles, notes are just no what most undergraduates are
                        	looking for. This I'm sure is another case in point of tab click mania. And then you see Location Tab in the list -- this is them clicking back on the original tab after realizing the other
                        	tabs really weren't particularly helpful. Full text is high obviously; you can see that our list feature is used a fair amount, as is requesting. It's also interesting to see
                        	the Browse shelf, and our feature to send the search out to our local TRLN consortium being relatively highly used in comparison with other things like emailing, printing, or texting a record.</section>
                    
                    <section>
                    	<h2>An apology</h2>
                    	<ul>
                    		<li>Longer term usage trends show the Contents (supplemental table of contents) tab usage being extremely high (*) </li>
                    		<li>Google Preview over the long haul is popular enough to make this top 10 list</li>
                    	</ul>
                    	<br />
                    	<br />
                    	<small> (*) sorry, that was a bug in the last code release</small>
                    	<aside class="notes">However, use of the "expand to TRLN" feature holds its own against Google Preview, which frankly surprises me. Now if only I knew better how much of this usage was library staff.</aside>
				</section>
				<section>
						<h5>A small link can overpower a fancy widget</h5>
						<a class="image"  href="images/catalog-shelf-browse.png" target="_blank">
                            <img  src="images/catalog-shelf-browse.png" alt="Full Record Preview" />
                        </a>
                        <aside class="notes">Note we have longer term statistics here, so I feel pretty confident about these numbers. 3/4 of users click on "Browse shelf" from the list of individual items
                        on the holdings tab, rather than the big fancy looking widget.</aside>
                        <small>Note: November - February, 2013</small>
                    </section>
                    <section>
						<a class="image"  href="images/catalog-shelf-browse-screenshot.png" target="_blank">
                            <img  src="images/catalog-shelf-browse-screenshot.png" alt="Full Record Preview" />
                        </a>
                        
                    </section>
                    <section>
						<h5>Having a link in more than one place can be helpful</h5>
						<a class="image"  href="images/catalog-requesting.png" target="_blank">
                            <img  src="images/catalog-requesting.png" alt="Full Record Preview" />
                        </a>
                        <aside class="notes"></aside>
                        <small>Note: January - February, 2013</small>
                    </section>
                     <section>
						<a class="image"  href="images/catalog-request-links.png" target="_blank">
                            <img  src="images/catalog-request-links.png" alt="Full Record Preview" />
                        </a>
                        <aside class="notes"></aside>
                    </section>
                    <section>
						<h5>Users make some decisions from the results list</h5>
						<a class="image"  href="images/catalog-add-list.png" target="_blank">
                            <img  src="images/catalog-add-list.png" alt="Full Record Preview" />
                        </a>
                        <aside class="notes"></aside>
                        <small>Note: February 5-7, 2013</small>
                    </section>
                      <section>
						<a class="image"  href="images/catalog-results-add-list.png" target="_blank">
                            <img  src="images/catalog-results-add-list.png" alt="Full Record Preview" />
                        </a>
                        <aside class="notes"></aside>
                    </section>
                    <section>
						<a class="image"  href="images/catalog-full-record-add-list.png" target="_blank">
                            <img  src="images/catalog-full-record-add-list.png" alt="Full Record Preview" />
                        </a>
                        <aside class="notes"></aside>
                    </section>
                    <section>
						<h5>But they still like to look at the full record</h5>
						<a class="image"  href="images/catalog-full-text.png" target="_blank">
                            <img  src="images/catalog-full-text.png" alt="Full Record Preview" />
                        </a>
                        <aside class="notes"></aside>
                        <small>Note: February 5-7, 2013</small>
                        <aside class="notes">70% of full text URL clicking is happening on the full record, even though the same URLs are offered on the results list</aside>
                    </section>
                    <section>
						<a class="image"  href="images/catalog-full-record-full-text.png" target="_blank">
                            <img  src="images/catalog-full-record-full-text.png" alt="Full Record Preview" />
                        </a>
                        <aside class="notes"></aside>
                    </section>
                    <section>
						<a class="image"  href="images/catalog-results-full-text.png" target="_blank">
                            <img  src="images/catalog-results-full-text.png" alt="Full Record Preview" />
                        </a>
                        <aside class="notes"></aside>
                    </section>
                    
                    <section>
                   		<h5>Users want to get stuff delivered (*)</h5>
                   		<a class="image"  href="images/catalog-tools.png" target="_blank">
                            <img  src="images/catalog-tools.png" alt="Full Record Preview" />
                        </a>
                   		<small>Note: November - February, 2013</small>
                        <small>(*) E-mail is a red herring; low reporting is due to a prior code bug. More recent numbers show it on par with texting.</small>
                        <aside class="notes">This graph shows use of tools in the toolstrip that runs across the top of the full record page (plus teh Add to List and Google Preview buttons). 
                        The uptake on the "Add to List" functionality is interesting and shows its popularity in gathering a set of things together for users. I'm hypothesizing here, but am betting
                        that has replaced users texting / emailing / printing individual records to themselves (don't actually have stats from the list at this point). 
                        
                    </section>
            	</section>
            	<section>
            		<section>
            			<h2>NCSU Summon Activity(*)</h2>
            				<p class="fragment">Tracking fewer things</p>
            				<p class="fragment">* Some things are almost impossible to track (ex: clicks to view full text)</p><br />
            				<p class="fragment">Picked the things that were most reasonable to track, rather than most desired</p>
            				
            				</ul>
            			</section>
            			<section>
            			<h2>What are we tracking?</h2>
            			<ul>
            				<li>Searches</li>
            				<li>Sorting</li>
            				<li>Paging</li>
            				<li>Facet activity</li>
            			</ul><br /><br />
            			<p>Most difficult to identify: user clicks to view full text. So we didn't go there.</p>
            			<aside class="notes">The biggest thing to note here is just that the list is a lot, lot smaller. Searching activity (advanced search, search refinements, actual new searches) is interesting, but we don't necessarily
            				care *that* much about paging or sorting. But they were easy to identify in the DOM. 
            		</section>
            	
            		<section>
            			<h2>Category: Search</h2>
            			<small>Different types of search activity</small>
            			<p>Search Button | New Search | Keep Search Refinements | Advanced Search</p>
            		</section>
            		<section>
            			<h2>Category: Sorting</h2>
            			<small>Sort options</small>
            			<p>Relevance | Date (newest) | Date (oldest)</p>
            		</section>
            		<section>
            			<h2>Category: Facet</h2>
            			<small>Clicks on actual facet values</small>
            			<p>Individual facet name + value</p>
            		</section>
            		<section>
            			<h2>Category: Paging</h2>
            			<small>User paging through results</small>
            			<p>Individual page number</p>
            		</section>
            	</section>
            	</section>
                	
            	<section>
					<section>
						<h2>Interesting Findings</h2>
						<small>November 2012 - February 2013</small>
					</section>
					<section>
						<h5>Paging is more popular than facets</h5>
						<a class="image"  href="images/summon-overall-activity.png" target="_blank">
                            <img  src="images/summon-overall-activity.png" alt="Full Record Preview" />
                        </a>
                    </section>
                    <section>
						<h5>Content Type and Subject are basically the only facets </h5>
						<a class="image"  href="images/summon-facet-usage.png" target="_blank">
                            <img  src="images/summon-facet-usage.png" alt="Full Record Preview" />
                        </a>
                    </section>
                    <section>
						<h5>Advanced search does get used....some</h5>
						<a class="image"  href="images/summon-search.png" target="_blank">
                            <img  src="images/summon-search.png" alt="Full Record Preview" />
                        </a>
                        <h5>Someone is using "Keep Search Refinements"...a lot</h5>
                    </section>
            	</section>
                <section>
                    <section>
                        <h2>The Plumbing</h2>
                        <p class="fragment">
                            Of course it involves jQuery!
                        </p>
                        <p class="fragment">
                            It doesn't <em>have</em> to, but that's how we did it.
                        </p>
                    </section>
            
                    <section>
                        <h2>GA Event Tracking API</h2>
                        <pre>
                            <code contenteditable>
// safely initialize _gaq; if GA loads after your code,
// any events already in the queue will be sent to the Goog.
var _gaq = _gaq || [];
...
_gaq.push(['_trackEvent', eventCategory, eventAction, optional_eventLabel, optional_eventValue ]);
                            </code>
                        </pre>
                        <p>That's really all there is to it; the "push" method takes an array, the first member of which is a command and the rest of which
                            constitute the arguments to that command.</p>
                    </section>
                    <section>
                        <h2>Event Overview</h2>
                        <p>
                            To track an event of a given type,  you need a <em>category</em> and an <em>action</em>.  Optionally, you can add a <em>label</em> and, if you add the label, you may also add a <em>value</em>.  Picking values for these things (and whether you use 2, 3, or 4 of them for any given event) is up to you.
                        </p>
                </section>
            </section>
                    
                <section>
                    <h2>Implementation Issues</h2>
                    <ul style="list-style-type: none;">
                        <li class="fragment">Q1. How do we get the right data into the GA <code>_trackEvent</code> ?</li>
                        <li class="fragment">Q2. How do we send events when "the right things" happen in the UI?</li>
                        <li class="fragment">A1. HTML5 Data Attributes</li>
                        <li class="fragment">A2. jQuery (or similar)</li>
                    </ul>
                    <aside class="notes">
                        Our use cases were fairly straightforward; most of the events we want to track involve tabs, accordions, and the occasional hyperlink.  We want these
                                actions to get logged somewhere.
                    </aside>
                </section>
                <section>
                    <section>
                    <h2>HTML5 Data Attributes</h2>
                        <h5>Actionable metadata!</h5>
                        <figure>
                            <blockquote cite="http://www.whatwg.org/specs/web-apps/current-work/multipage/elements.html#embedding-custom-non-visible-data-with-the-data-*-attributes">User agents must not derive any implementation behavior from these attributes or values. Specifications intended for user agents must not define these attributes to have any meaningful values.</blockquote>
                            <figcaption><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/elements.html#embedding-custom-non-visible-data-with-the-data-*-attributes">WHATWG</a> (2013-02-05)</figcaption>
                        </figure>
                    </section>
                    <section>
                        <h2>Huh?</h2>
                        <p><code>data-*</code> attributes give you a place to put data for use by your scripts.  Browsers shouldn't try to do anything with them, and you shouldn't
                            use them to add visual styles.
                        </p>
                    </section>
                    <section>
                     <h2>Attributes Just for Your Scripts</h2>
                     <h6>HTML</h6>
                     <pre>
                        <code>
&lt;a href="#marc" data-ga-event="Record,Tab,MARC"&gt;Marc Record&lt;/a&gt;
</code>
</pre>
<h6>jQuery API</h6>
    <pre>
        <code>

$("a[data-ga-event]").on("click", function(evt) {
    // data-ga-event =&gt; "gaEvent"
    var data = $(this).data("gaEvent").split(",");
    data.unshift("_trackEvent");
    // data == ['_trackEvent','Record','Tab','Marc']
    _gaq.push(data);
});
                        </code>
                    </pre>
                </section>
            </section>
            <section>
                <section>
                        <h2>Putting it Together</h2>
                        
                        <ol>
                            <li class="fragment">Make an event taxonomy</li>
                            <li class="fragment">Edit markup</li>
                            <li class="fragment">Add handlers for the events you want to track</li>
                            <li class="fragment">Sit back and wait for the <strike>money</strike> data to roll in</li>                       
                        </ol>
                    </section>

                    <section>
                        <h2>Add Handlers</h2>
                        <pre>
                            <code>
var _gaq = _gaq || [];

function logGAEvent(data) {
    data.unshift("_trackEvent");
    _gaq.push(data);
}

$(document).ready( 
    function() {
        $("*[data-ga-event]").click( 
            function(evt) {
                var data = $(this).data("gaEvent").split(",");
                logGAEvent(data);
            }
        );
    }
);
                </code>
                        </pre>
                    </section>
                   
                </section>

                <section>
                    <h2>Really, That's It?</h2>
                    <p>Yes.</p>
                    <p class="fragment">
                        Ok, no, but that's the basic technique.
                    </p>
                </section>
                 <section>
                        <h2>On The Coding Style</h2>

                        <h6 id="blinky" style="text-decoration: blink;">Don't Actually Do That</h6>
                        <p>
                        <small>
                            These are stick figure drawings of actual production code.
                        </small>
                        </p>
                    <p class="fragment">
                        Please also don't use <code>text-decoration: blink</code>
                    </p>
                    <p class="fragment">
                        And really don't go out and add CSS3 animation styles to simulate blinking text on Chrome for the sake of a gag.
                    </p>
                    </section>
                </section>

        <section>   
                <section>
                    <h2>When it's Not Your Markup</h2>
                    <p>You might want to track things going on in an externally hosted service, such as we did with Summon, which generates its own HTML.  Adding
                        our own HTML5 data attributes here is not possible.
                    </p>
                </section>
                <section>
                    <h2>Not Your Markup (cont.)</h2>
                    <ul>
                        <li>Find a way to inject your javascript (and, if needed, GA) onto the page.</li>
                        <li>Add tracking data to elements programmatically.</li>
                    </ul>
                </section>
                <section>
                    <h2>Inject JavaScript</h2>
                        <p>Matthew Reidsma's <a href="https://github.com/mreidsma/Summon-Stats">Summon Stats</a> showed us how to load external JavaScript onto our Summon pages.</p>
                        <p>For other services, if there's no direct support for it, the product's site customization features might allow adding <code>&lt;script&gt;</code> tags.</p>
                </section>
                <section>
                    <h2>Add Tracking Data</h2>

                    <ul>
                    <li>You'll have to use more selectors.</li>
                    <li>You may have to use specific location in the DOM instead of <code>id</code> and <code>class</code> attributes.</li>

                    </ul>
                </section>
                <section>
                    <h2>Example</h2>
                            <pre>
                                <code contenteditable>
// from our custom summon-analytics.js
$("#pageNavigation a[href^='/search']").click( 
    function(evt) {
        var link = $(evt.target);
        var lt = $.trim(link.text());
        if ( lt == "Next" ) {
            lt = "" + (thisPage +1);
        } else if ( lt == "Prev" ) {
            lt = "" + (thisPage -1);
        }
        logEvent("Paging", "Page", lt);
    }
);
        </code>
    </pre>
    <p>This puts the event data into the event handler, but you could also write data to the element on page load and do something more like we did in our catalog.
    </p>
        </section>
                    
    </section> <!-- end Summon discussion -->
            
   
                <section>
                    <h2>Explorations</h2>
                    <ul>
                        <li class="fragment">Testing and Debugging</li>
                        <li class="fragment">AJAX Content</li>                        
                        <li class="fragment">Selector Strategies</li>
                        <li class="fragment">Tracking Tweaks</li>
                    </ul>
                </section>
                <section>
                <section>
                        <h2>Troublerebuking, Debugging, and Testing</h2>
                        <ul >
                            <li>Be proactive!  Set up a safety net first</li>
                            <li>Emphasis:  don't be like me; plan for testability up front.</li>
                            <li>Make friends with your browser's dev tools/debugger.</li>
                        </ul>
                </section>
                <section>
                    <h2>&#x201c;Fire it up and see if it works?&#x201d;</h2>
                    <p>
                        We found that it can take up to a day for an event to show up in the GA dashboard, so this is an error-prone and time consuming testing strategy.
                    </p>
                </section>

                <section>
                    <h2>Working With a Net</h2>
                    <ul>
                        <li>Write a separate function that actually does the event logging, rather than doing it inline.</li>
                        <li>Ditto for the click handler function.</li>
                        <li>Test everything you can see and control *before* you try sending events to the third party</li>
                    </ul>
                    <aside class="notes"> 
                        <pre><code>$("*[data-ga-event]").css("border", "5px solid red");</code></pre> in the JavaScript console.
                    </aside>
                        
                </section>
                <section>
                    <h2>Above All</h2>
                    <h6>Be the kind of person that writes automated tests.</h6> 
                    <ul>
                    <li>Write your JavaScript so it's testable 
                        <ul>
                            <li>use named functions</li>
                            <li>Single Responsibility Principle -- don't do too much in your functions.</li>
                        </ul>
                    <li>Learn and use a JavaScript testing framework (qUnit, Jasmine, Mocha, etc.)</li>
                </ul>
                </section>
                <section>
                 <h2>Other Safety Tips</h2>
                    <ul>
                        <li class="fragment">Know that <code>_gaq.push()</code> returns a boolean indicating success or failure (just like Array.push()).</li>
                        <li class="fragment">Load <code>ga_debug.js</code> instead of <code>ga.js</code> during development; this outputs information about what GA is actually doing behind the scenes in your
                            browser's console.
                        </li>
                        <li class="fragment">If you're a Chrome user install the Google Analytics Debugging extension; this lets you dynamically enable <code>ga_debug.js</code> in your browser, which is
                            very handy if you're working on a live site.</li>
                    </ul>
                </section>
            </section>

            <section>
                        <section>
                            <h2>Tracking Events in AJAX Content</h2>

                            <ul>
                                <li>You may not control the markup</li>
                                <li>The tracked elements are not in the DOM when the page is loaded, so you have to do a bit more work in your selectors</li>
                            </ul>
                        </section>
                    <section>
                        <h2>AJAX Content Tracking (cont.)</h2>
                        <p>jQuery lets you specify handlers for events for elements that don't exist yet, by (essentially) listening on an (existing) element that (will) contain them.  This is not the only approach, but is the easiest to work with.
                    </p>
                        <pre>
                                <code contenteditable>
// our catalog loads transformed EAD XML via XHR when users click on the content tab
$("#contents").on("click", ".EAD_daolink", function(evt) {
    logGAEvent($(this), ['URL','Digitized Content','CCC']);
});
                            </code>
                        </pre>
                    <aside class="notes">
                        An alternate approach is to chain an event handler that attaches the events after the content is loaded.  This works, but it's more code and, "yo dawg" and all that.
                    </aside>
                    </section>
                </section> <!-- end AJAX -->


            <section>
                        <h2>On Selector Strategy (Your Markup)</h2>
                        <ul>
                            <li><code>*[data-ga-event]</code> matches all elements with tracking data, but is potentially very slow; this data can be valuable, but you don't want to
                                frustrate your users.</li>
                            <li>If you use a CSS class in concert with it (e.g. <code>.tracked[data-ga-event]</code>, it's both faster and you can temporarily disable 
                                tracking for some elements should you need to, by simply removing the class.</li>
                        </ul>
                    </section>
  
                    <section>
                        <h2>Tracking Tweaks</h2>
                        <p>We've shown some very simple examples, but you might want to do something fancier (do people do Y after trying X?) which requires
                            maintaining state.
                        </p>
                        <p class="fragment">
                            jQuery's Data API can be used to write data onto elements.
                         </p>
                         <p class="fragment">This can probably get a bit crazy though.</p>

                    </section>
                    <!--      
                         <pre>
                            <code>
// pass in the element that has the data attribute on it
function logGAEvent(el,data) {
    if ( !el._tracked ) {
        if ( data[0] !== '_trackEvent' ) {
            data.unshift("_trackEvent");
        }
        // the .push() method returns a boolean indicating whether the event was sent.
        el._tracked = _gaq.push(data);
    }
}
</code>
                         </pre>
                         <p>Again, this is not intended to be production-ready, but just to illustrate the technique.</p>
                    </section>
                    -->
                    
                <section>
                    <h2>Links</h2>
                    <ul>
                        <li>Official GA Docs
                            <ul>
                                <li><a href="https://developers.google.com/analytics/devguides/collection/gajs/methods/gaJSApiEventTracking">Event Tracking</a></li>
                                <li><a href="https://developers.google.com/analytics/resources/articles/gaTrackingTroubleshooting">Troubleshooting Guide</a></li>
                            </ul>
                        </li>
                         <li><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/elements.html#embedding-custom-non-visible-data-with-the-data-*-attributes">data-* attributes (WHATWG)</a></li>
                        <li><a href="http://api.jquery.com/data/">jQuery.data() API</a></li>
                        <li><a href="https://github.com/mreidsma/Summon-Stats">Summon Stats</a (github) by Matt Reidsma.</li>
                    </ul>
                </section>

                <section>
                    <h2>About This Presentation</h2>
                    <p>We forked <a href="https://github.com/hakimel/reveal.js">reveal.js</a> on github and did our edits there.</p>
                </section>

            </div>

        </div>

        <script src="lib/js/head.min.js"></script>
        <script src="js/reveal.min.js"></script>

        <script>

            // Full list of configuration options available here:
            // #configuration
            Reveal.initialize({
                controls: true,
                progress: true,
                history: true,
                center: true,
                overview: true,

                theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
                transition: Reveal.getQueryHash().transition || 'fade', // default/cube/page/concave/zoom/linear/fade/none

                // Optional libraries used to extend on reveal.js
                dependencies: [
                    { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
                    { src: 'plugin/markdown/showdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
                    { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
                    { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
                    // { src: 'plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
                ]
            });

        </script>

    </body>
</html>
